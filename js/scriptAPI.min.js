/*! albumpuc 06-07-2018 Trabalho em Grupo PUC */

var API_URL="https://api.shutterstock.com/v2",pesquisaFlag="false";function encodeAuthorization(){var e=$("input[name=client_id]").val(),t=$("input[name=client_secret]").val();return e&&t?"Basic "+window.btoa(e+":"+t):($("#collapseAuthentication").collapse("show"),void alert("Client id and/or client secret are missing in the API key section, with out these you wont be able to contact the API."))}function search(t,i){var n=$("#"+i+"-search-results"),s="image"===i?renderImageComponent:null;if(authorization=encodeAuthorization(),authorization)return $.ajax({url:API_URL+"/"+i+"s/search",data:t,headers:{Authorization:authorization}}).done(function(e){if(0!==e.total_count){var i=/horizontal/.test(t)?"horizontal-image":"vertical-image";$.each(e.data,function(e,t){var a=s(t,i);n.append(a)}),window.innerWidth<700&&$(".collapse.in").collapse()}else n.append("<p>Nenhum resultado a ser exibido</p>")}).fail(function(e,t,a){alert("Failed to retrieve "+i+" search results:\n"+JSON.stringify(e.responseJSON,null,2))})}function fetchDetails(e){e.preventDefault();var t=e.target.id,i="IMG"===e.target.tagName?"image":null,a=encodeAuthorization();if(t&&a)return renderLoadingDetails(t),$.ajax({url:API_URL+"/"+i+"s/"+t,headers:{Authorization:a}}).done(function(e){console.log("JSON response",e),e&&e.assets&&e.assets&&renderDetails(e)}).fail(function(e,t,a){alert("Failed to retrieve "+i+" details:\n"+JSON.stringify(e.responseJSON,null,2))})}function renderImageComponent(e,t){if(e&&e.assets&&e.assets.large_thumb&&e.assets.large_thumb.url){var a=$("<div>"),i=$("<div>"),n=$("<img>");$("<p>");return $(n).click(fetchDetails).attr("id",e.id).attr("src",e.assets.large_thumb.url).attr("title",e.description),$(i).addClass("thumbnail-crop").css("height",e.assets.large_thumb.height).css("width",e.assets.large_thumb.width).append(n),$(a).addClass("image-float-wrapper image "+t).append(i),a}}function renderDetails(e){var t=$(".detail-template");if(t.find(".modal-body").html("<div></div><p><strong>Keywords: </strong><small></small></p>"),"image"===e.media_type){var a=$("<div>"),i=$("<img>");$(i).click(fetchDetails).attr("id",e.id).attr("src",e.assets.preview.url).attr("title",e.description),$(a).addClass("thumbnail-crop").css("height",e.assets.preview.height).css("width",e.assets.preview.width).append(i),t.find(".modal-body").find("div").append(a)}t.find("h3").html(e.description),t.find("small").html(e.keywords.join(", ")),document.getElementById("idFoto").value=e.assets.preview.url}function renderLoadingDetails(e){var t=$(".detail-template");t.find(".modal-body").html('<i class="fa fa-5x fa-spinner fa-spin"></i>'),t.find("h3").html("Loading "+e+"..."),t.modal("show")}function renderCategories(){var t=$('[name="category"]')[0];["Abstract","Animals/Wildlife","Backgrounds/Textures","Beauty/Fashion","Buildings/Landmarks","Business/Finance","Celebrities","Editorial","Education","Food and Drink","Healthcare/Medical","Holidays","Illustrations/Clip-Art","Industrial","Interiors","Miscellaneous","Model Released Only","Nature","Objects","Parks/Outdoor","People","Religion","Science","Signs/Symbols","Sports/Recreation","Technology","The Arts","Transportation","Vectors","Vintage"].map(function(e){t.add(new Option(e,e))})}function setDefaultPerPage(){var e,t=window.innerWidth*window.innerHeight/4e4;$("select[name=per_page]").find("option").each(function(){this.value<t&&(e=this.value)}),e&&$("select[name=per_page]").val(e)}function setColor(e){$("input[name=color]").val(e.value)}function useColorsInNatureIfSearchingOnlyByColor(e){return/color/.test(e)&!/category/.test(e)&&!/query/.test(e)&&(e+="&category=Nature"),e}function pesquisa(e){Menu("buscarImagens"),pesquisaFlag="true",$("#search-form").submit()}$(function(){renderCategories(),setDefaultPerPage(),$("#search-form").submit(function(e){e.preventDefault(),$("#image-search-results").empty(),"true"==pesquisaFlag&&(document.getElementById("query").value=document.getElementById("pesquisatxt").value,pesquisaFlag=!1,document.getElementById("pesquisatxt").value="");var t=$("input").filter(function(){if("#999999"!==this.value&&"client_id"!==this.name&&"client_secret"!==this.name)return!!this.value}).serialize();t=useColorsInNatureIfSearchingOnlyByColor(t+="&"+$("select").filter(function(){return!!this.value}).serialize()),console.log("Requesting: "+t),search(t,"image");var a=$("select[name=per_page]").val();return 24<a&&(t=t.replace("per_page="+a,"per_page="+a/2)),!1}),$("#search-form").submit()});